<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Ecosystem Health - Mangrove Sentinel</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/static/style.css"/>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="dark">
  <header class="navbar container">
    <div class="brand">
      <div class="logo-dot"></div>
      <span class="brand-text">Mangrove Sentinel</span>
    </div>
    <nav class="nav-links">
      <a href="/conservation">Conservation</a>
      <a href="/ecosystem" class="active">Ecosystem</a>
      <a href="/community">Community</a>
      <a href="/events">Events</a>
    </nav>
    <div class="nav-actions">
      <a class="btn btn-white" href="/profile">Profile</a>
      <a class="btn btn-green" href="/dashboard">Dashboard</a>
    </div>
    <button class="nav-toggle" aria-label="toggle menu">
      <span></span><span></span><span></span>
    </button>
  </header>

  <main class="container section">
    <div class="section-head">
      <h1>üåä Ecosystem Health</h1>
      <p class="muted">Real-time monitoring of mangrove biodiversity and environmental indicators</p>
    </div>

    <!-- Health Metrics -->
    <div class="grid grid-4 kpis">
      <div class="card kpi">
        <span class="kpi-label">Water Quality</span>
        <span class="kpi-value" id="water-quality" style="color: var(--green);">82</span>
        <div class="kpi-unit">WQI</div>
      </div>
      <div class="card kpi">
        <span class="kpi-label">Species Count</span>
        <span class="kpi-value" id="species-count">247</span>
      </div>
      <div class="card kpi">
        <span class="kpi-label">Forest Cover</span>
        <span class="kpi-value" id="forest-cover" style="color: var(--green);">78%</span>
      </div>
      <div class="card kpi">
        <span class="kpi-label">Health Score</span>
        <span class="kpi-value" id="health-score" style="color: var(--amber);">7.4</span>
        <div class="kpi-unit">/10</div>
      </div>
    </div>

    <!-- Environmental Charts -->
    <div class="grid grid-2 mt-lg">
      <div class="card">
        <h3>Environmental Trends</h3>
        <canvas id="environmentalChart" height="140"></canvas>
      </div>
      <div class="card">
        <h3>Biodiversity Index</h3>
        <canvas id="biodiversityChart" height="140"></canvas>
      </div>
    </div>

    <!-- Species Diversity -->
    <section class="mt-lg">
      <h2>Key Species Monitoring</h2>
      <div class="grid grid-3 mt-md">
        <div class="card">
          <img src="https://images.unsplash.com/photo-1552728089-57bdde30beb3?q=80&w=800&auto=format&fit=crop" 
               alt="Birds" style="width: 100%; height: 150px; object-fit: cover; border-radius: 8px;">
          <div style="padding: 16px 0;">
            <h4>Migratory Birds</h4>
            <p class="muted">87 species documented this season</p>
            <div class="kpi-value" style="color: var(--green); font-size: 18px;">+12%</div>
            <p style="margin: 0; color: var(--muted); font-size: 12px;">vs last year</p>
          </div>
        </div>

        <div class="card">
          <img src="https://images.unsplash.com/photo-1559827260-dc66d52bef19?q=80&w=800&auto=format&fit=crop" 
               alt="Fish" style="width: 100%; height: 150px; object-fit: cover; border-radius: 8px;">
          <div style="padding: 16px 0;">
            <h4>Marine Life</h4>
            <p class="muted">156 fish species identified</p>
            <div class="kpi-value" style="color: var(--amber); font-size: 18px;">-3%</div>
            <p style="margin: 0; color: var(--muted); font-size: 12px;">vs last year</p>
          </div>
        </div>

        <div class="card">
          <img src="https://images.unsplash.com/photo-1602491990095-53350b92d5de?q=80&w=800&auto=format&fit=crop" 
               alt="Mangroves" style="width: 100%; height: 150px; object-fit: cover; border-radius: 8px;">
          <div style="padding: 16px 0;">
            <h4>Plant Species</h4>
            <p class="muted">34 mangrove species thriving</p>
            <div class="kpi-value" style="color: var(--green); font-size: 18px;">+8%</div>
            <p style="margin: 0; color: var(--muted); font-size: 12px;">vs last year</p>
          </div>
        </div>
      </div>
    </section>

    <!-- Ecosystem Services -->
    <section class="mt-lg">
      <h2>Ecosystem Services</h2>
      <div class="grid grid-2 mt-md">
        <div class="card">
          <h3>Carbon Sequestration</h3>
          <div style="display: flex; align-items: center; gap: 16px; margin: 16px 0;">
            <div style="flex: 1;">
              <div class="kpi-value" style="color: var(--green);">2.4M</div>
              <p class="muted" style="margin: 0;">tonnes CO‚ÇÇ/year captured</p>
            </div>
            <div style="width: 60px; height: 60px; border-radius: 50%; background: var(--green); display: flex; align-items: center; justify-content: center; font-size: 24px;">üå±</div>
          </div>
          <div class="progress-bar" style="background: var(--bg-secondary); height: 8px; border-radius: 4px; overflow: hidden;">
            <div style="width: 78%; height: 100%; background: var(--green);"></div>
          </div>
          <p style="margin: 8px 0 0 0; font-size: 12px; color: var(--muted);">78% of annual target achieved</p>
        </div>

        <div class="card">
          <h3>Storm Protection</h3>
          <div style="display: flex; align-items: center; gap: 16px; margin: 16px 0;">
            <div style="flex: 1;">
              <div class="kpi-value" style="color: var(--blue);">450km</div>
              <p class="muted" style="margin: 0;">coastline protected</p>
            </div>
            <div style="width: 60px; height: 60px; border-radius: 50%; background: var(--blue); display: flex; align-items: center; justify-content: center; font-size: 24px;">üõ°Ô∏è</div>
          </div>
          <div class="progress-bar" style="background: var(--bg-secondary); height: 8px; border-radius: 4px; overflow: hidden;">
            <div style="width: 85%; height: 100%; background: var(--blue);"></div>
          </div>
          <p style="margin: 8px 0 0 0; font-size: 12px; color: var(--muted);">85% protection coverage achieved</p>
        </div>
      </div>
    </section>

    <!-- Threat Assessment -->
    <section class="mt-lg">
      <h2>Current Ecosystem Threats</h2>
      <div class="card mt-md">
        <div class="grid grid-4" style="gap: 16px;">
          <div style="text-align: center; padding: 16px;">
            <div style="font-size: 32px; margin-bottom: 8px;">üè≠</div>
            <div class="kpi-value" style="color: var(--red); font-size: 18px;">High</div>
            <p class="muted" style="margin: 4px 0 0 0; font-size: 12px;">Industrial Pollution</p>
          </div>
          <div style="text-align: center; padding: 16px;">
            <div style="font-size: 32px; margin-bottom: 8px;">üèóÔ∏è</div>
            <div class="kpi-value" style="color: var(--amber); font-size: 18px;">Medium</div>
            <p class="muted" style="margin: 4px 0 0 0; font-size: 12px;">Urban Development</p>
          </div>
          <div style="text-align: center; padding: 16px;">
            <div style="font-size: 32px; margin-bottom: 8px;">üå°Ô∏è</div>
            <div class="kpi-value" style="color: var(--red); font-size: 18px;">High</div>
            <p class="muted" style="margin: 4px 0 0 0; font-size: 12px;">Climate Change</p>
          </div>
          <div style="text-align: center; padding: 16px;">
            <div style="font-size: 32px; margin-bottom: 8px;">üé£</div>
            <div class="kpi-value" style="color: var(--amber); font-size: 18px;">Medium</div>
            <p class="muted" style="margin: 4px 0 0 0; font-size: 12px;">Overfishing</p>
          </div>
        </div>
      </div>
    </section>

    <!-- Monitoring Stations -->
    <section class="mt-lg">
      <h2>Active Monitoring Stations</h2>
      <div class="card mt-md">
        <div style="overflow-x: auto;">
          <table style="width: 100%; border-collapse: collapse;">
            <thead>
              <tr style="border-bottom: 1px solid var(--line);">
                <th style="text-align: left; padding: 12px; color: var(--muted);">Station</th>
                <th style="text-align: left; padding: 12px; color: var(--muted);">Location</th>
                <th style="text-align: center; padding: 12px; color: var(--muted);">Status</th>
                <th style="text-align: right; padding: 12px; color: var(--muted);">Last Reading</th>
              </tr>
            </thead>
            <tbody>
              <tr style="border-bottom: 1px solid var(--line);">
                <td style="padding: 12px; font-weight: 500;">Sundarbans-01</td>
                <td style="padding: 12px; color: var(--muted);">West Bengal</td>
                <td style="padding: 12px; text-align: center;">
                  <span style="padding: 4px 8px; border-radius: 12px; font-size: 12px; background: var(--green); color: #06240f;">Online</span>
                </td>
                <td style="padding: 12px; text-align: right; color: var(--muted);">2 hours ago</td>
              </tr>
              <tr style="border-bottom: 1px solid var(--line);">
                <td style="padding: 12px; font-weight: 500;">Bhitarkanika-02</td>
                <td style="padding: 12px; color: var(--muted);">Odisha</td>
                <td style="padding: 12px; text-align: center;">
                  <span style="padding: 4px 8px; border-radius: 12px; font-size: 12px; background: var(--green); color: #06240f;">Online</span>
                </td>
                <td style="padding: 12px; text-align: right; color: var(--muted);">1 hour ago</td>
              </tr>
              <tr style="border-bottom: 1px solid var(--line);">
                <td style="padding: 12px; font-weight: 500;">Pichavaram-03</td>
                <td style="padding: 12px; color: var(--muted);">Tamil Nadu</td>
                <td style="padding: 12px; text-align: center;">
                  <span style="padding: 4px 8px; border-radius: 12px; font-size: 12px; background: var(--amber); color: #2f1b00;">Maintenance</span>
                </td>
                <td style="padding: 12px; text-align: right; color: var(--muted);">6 hours ago</td>
              </tr>
              <tr>
                <td style="padding: 12px; font-weight: 500;">Coringa-04</td>
                <td style="padding: 12px; color: var(--muted);">Andhra Pradesh</td>
                <td style="padding: 12px; text-align: center;">
                  <span style="padding: 4px 8px; border-radius: 12px; font-size: 12px; background: var(--green); color: #06240f;">Online</span>
                </td>
                <td style="padding: 12px; text-align: right; color: var(--muted);">30 minutes ago</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </section>

    <!-- Call to Action -->
    <div class="center mt-lg">
      <a class="btn btn-green" href="/report">Report Environmental Issues</a>
      <a class="btn btn-white" href="/dashboard" style="margin-left: 12px;">View Dashboard</a>
    </div>
  </main>

  <footer class="footer">
    <div class="container footer-note">¬© Team DZ | Hackout'25 | Project Mangrove Sentinel</div>
  </footer>

  <script src="/static/auth.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', async function() {
      await loadEcosystemData();
    });

    async function loadEcosystemData() {
      try {
        // Load health metrics
        const metricsResponse = await fetch('/api/v1/ecosystem/health-metrics');
        if (metricsResponse.ok) {
          const metrics = await metricsResponse.json();
          document.getElementById('water-quality').textContent = metrics.water_quality;
          document.getElementById('species-count').textContent = metrics.species_count;
          document.getElementById('forest-cover').textContent = metrics.forest_cover + '%';
          document.getElementById('health-score').textContent = metrics.health_score;
        }

        // Load environmental trends
        const trendsResponse = await fetch('/api/v1/ecosystem/environmental-trends');
        if (trendsResponse.ok) {
          const trends = await trendsResponse.json();
          createEnvironmentalChart(trends);
        }

        // Load biodiversity data
        const biodiversityResponse = await fetch('/api/v1/ecosystem/biodiversity-data');
        if (biodiversityResponse.ok) {
          const biodiversity = await biodiversityResponse.json();
          createBiodiversityChart(biodiversity);
        }

        // Load species trends
        const speciesResponse = await fetch('/api/v1/ecosystem/species-trends');
        if (speciesResponse.ok) {
          const species = await speciesResponse.json();
          updateSpeciesTrends(species);
        }

        // Load monitoring stations
        const stationsResponse = await fetch('/api/v1/ecosystem/monitoring-stations');
        if (stationsResponse.ok) {
          const stations = await stationsResponse.json();
          updateMonitoringStations(stations);
        }
      } catch (error) {
        console.error('Error loading ecosystem data:', error);
        // Fallback to default charts if API fails
        createDefaultCharts();
      }
    }

    function createEnvironmentalChart(trends) {
      const envCtx = document.getElementById('environmentalChart');
      if (envCtx) {
        new Chart(envCtx, {
          type: 'line',
          data: {
            labels: trends.labels,
            datasets: [{
              label: 'Water Quality',
              data: trends.water_quality,
              borderColor: '#00d4aa',
              fill: false,
              tension: 0.35
            }, {
              label: 'Air Quality',
              data: trends.air_quality,
              borderColor: '#ffd60a',
              fill: false,
              tension: 0.35
            }]
          },
          options: {
            plugins: { legend: { display: true } },
            scales: {
              x: { grid: { display: false }, ticks: { color: '#bdbdbd' } },
              y: { grid: { color: 'rgba(255,255,255,0.08)' }, ticks: { color: '#bdbdbd' } }
            }
          }
        });
      }
    }

    function createBiodiversityChart(biodiversity) {
      const bioCtx = document.getElementById('biodiversityChart');
      if (bioCtx) {
        new Chart(bioCtx, {
          type: 'doughnut',
          data: {
            labels: biodiversity.labels,
            datasets: [{
              data: biodiversity.data,
              backgroundColor: ['#00d4aa', '#007ea7', '#ffd60a', '#ff6b35', '#9b59b6']
            }]
          },
          options: {
            plugins: { legend: { position: 'bottom' } }
          }
        });
      }
    }

    function updateSpeciesTrends(species) {
      // Update species trend displays with real data
      console.log('Species trends loaded:', species);
    }

    function updateMonitoringStations(stations) {
      // Update monitoring stations table with real data
      console.log('Monitoring stations loaded:', stations);
    }

    function createDefaultCharts() {
      // Default charts if API fails
      const envCtx = document.getElementById('environmentalChart');
      if (envCtx) {
        new Chart(envCtx, {
          type: 'line',
          data: {
            labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul'],
            datasets: [{
              label: 'Water Quality',
              data: [75, 78, 82, 79, 84, 82, 85],
              borderColor: '#00d4aa',
              fill: false,
              tension: 0.35
            }]
          },
          options: {
            plugins: { legend: { display: true } },
            scales: {
              x: { grid: { display: false }, ticks: { color: '#bdbdbd' } },
              y: { grid: { color: 'rgba(255,255,255,0.08)' }, ticks: { color: '#bdbdbd' } }
            }
          }
        });
      }
    }
  </script>
  <script defer src="/static/script.js"></script>
</body>
</html>